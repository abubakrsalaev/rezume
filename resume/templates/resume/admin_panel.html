{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Админка</title>
  <style>
    body{font-family:Arial;background:#0f0f0f;color:#fff;margin:0;padding:20px}
    .row{display:flex;gap:20px;flex-wrap:wrap}
    .card{background:#1c1c1c;padding:15px;border-radius:12px;flex:1;min-width:300px}
    input,textarea{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:none}
    textarea{min-height:120px;resize:vertical}
    button{padding:12px 16px;border:none;border-radius:10px;cursor:pointer;margin-top:10px}
    .top{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}
    .mini{opacity:.7;font-size:14px}
  </style>
</head>
<body>

<div class="top">
  <div>
    <h2>Админка</h2>
    <div class="mini">Меняешь всё слева + фото + данные справа</div>
  </div>
  <div>
    <a href="/" style="color:#fff;margin-right:15px">На сайт</a>
    <a href="/logout/" style="color:#ff8080">Выйти</a>
  </div>
</div>

<form id="adminForm" enctype="multipart/form-data">
  {% csrf_token %}

  <div class="row">

    <div class="card">
      <h3>Профиль</h3>
      <input name="full_name" value="{{ profile.full_name }}" placeholder="Имя">
      <textarea name="about_text" placeholder="Обо мне (если нужно)">{{ profile.about_text }}</textarea>

      <label style="display:block;margin-top:10px">Фото (аватар)</label>
      <input type="file" name="avatar">
    </div>

    <div class="card">
      <h3>Правая часть (не меняется)</h3>
      <input name="qualification" value="{{ profile.qualification }}" placeholder="Квалификация">
      <input name="hobbies" value="{{ profile.hobbies }}" placeholder="Хобби">

      <h4>Языки</h4>
      <input name="language_1" value="{{ profile.language_1 }}" placeholder="Язык 1">
      <input name="language_1_stars" value="{{ profile.language_1_stars }}" placeholder="Звёзды 1 (0-5)">

      <input name="language_2" value="{{ profile.language_2 }}" placeholder="Язык 2">
      <input name="language_2_stars" value="{{ profile.language_2_stars }}" placeholder="Звёзды 2 (0-5)">

      <input name="language_3" value="{{ profile.language_3 }}" placeholder="Язык 3">
      <input name="language_3_stars" value="{{ profile.language_3_stars }}" placeholder="Звёзды 3 (0-5)">
    </div>

  </div>

  <div class="card" style="margin-top:20px">
    <h3>Разделы (левая зелёная часть)</h3>

    {% for b in blocks %}
      <hr style="opacity:.2">
      <input name="block_key" value="{{ b.key }}" readonly>
      <input name="block_title" value="{{ b.title }}" placeholder="Заголовок">
      <textarea name="block_content" placeholder="Текст">{{ b.content }}</textarea>

      <input name="block_instagram" value="{{ b.instagram }}" placeholder="Instagram ссылка (для поддержки)">
      <input name="block_telegram" value="{{ b.telegram }}" placeholder="Telegram ссылка (для поддержки)">
    {% endfor %}
  </div>

  <button type="button" onclick="saveAdmin()">Сохранить</button>
  <div id="msg" style="margin-top:10px"></div>
</form>

<script>
async function saveAdmin(){
  const form = document.getElementById("adminForm");
  const data = new FormData(form);

  const res = await fetch("/admin-save/", {
    method: "POST",
    body: data
  });

  const json = await res.json();
  document.getElementById("msg").innerText = json.ok ? "✅ Сохранено" : ("❌ Ошибка: " + json.error);
}
</script>

</body>
</html>